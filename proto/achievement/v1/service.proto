syntax = "proto3";

package achievement.v1;

option go_package = "github.com/StudJobs/proto_srtucture/gen/go/achievement/v1";

import "proto/achievement/v1/types.proto";
import "proto/common/v1/types.proto";

service AchievementService {
  // Получить все достижения пользователя (только метаданные)
  rpc GetAllAchievements(GetAllAchievementsRequest) returns (AchievementList);

  // Получить URL для скачивания достижения (просмотра)
  rpc GetAchievementDownloadUrl(GetAchievementRequest) returns (AchievementUrl);

  // Получить URL для загрузки файла достижения (presigned URL)
  rpc GetAchievementUploadUrl(GetAchievementUploadRequest) returns (GetAchievementUploadResponse);

  // Добавить метаданные достижения после успешной загрузки в S3
  rpc AddAchievementMeta(AddAchievementMetaRequest) returns (common.v1.Empty);

  // Удалить достижение (метаданные + файл из S3)
  rpc DeleteAchievement(DeleteAchievementRequest) returns (common.v1.Empty);
}

// ============ REQUEST/RESPONSE MESSAGES ============

// Запрос на получение всех достижений пользователя
message GetAllAchievementsRequest {
  string user_uuid = 1; // UUID пользователя для фильтрации
}

// Запрос на получение конкретного достижения
message GetAchievementRequest {
  string user_uuid = 1;        // UUID пользователя (для проверки прав доступа)
  string achievement_name = 2; // Уникальное имя достижения в рамках пользователя
}

// Запрос на получение URL для загрузки файла в S3
message GetAchievementUploadRequest {
  string user_uuid = 1;        // UUID пользователя
  string achievement_name = 2; // Уникальное имя достижения
  string file_name = 3;        // Оригинальное имя файла
  string file_type = 4;        // MIME-тип файла
  int64 file_size = 5;         // Размер файла в байтах (для валидации)
}

// Ответ с URL для загрузки
message GetAchievementUploadResponse {
  string upload_url = 1;       // Presigned URL для загрузки
  string s3_key = 2;           // S3 ключ файла (нужен для AddAchievementMeta)
  int64 expires_at = 3;        // Время истечения срока действия URL
}

// Запрос на добавление метаданных достижения
message AddAchievementMetaRequest {
  AchievementMeta meta = 1;    // Метаданные достижения
  string s3_key = 2;           // S3 ключ из GetAchievementUploadResponse
}

// Запрос на удаление достижения
message DeleteAchievementRequest {
  string user_uuid = 1;        // UUID пользователя
  string achievement_name = 2; // Имя удаляемого достижения
}